<!DOCTYPE html>
<html>
  <head>
    <title>Deployd Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- <link rel='stylesheet/less' type="text/css" href='/dashboard/stylesheets/style.less' /> -->
    <!-- <script type="text/javascript" src="/dashboard/js/lib/less-1.3.0.min.js"></script> -->
    <link rel='stylesheet' type="text/css" href='/dashboard/stylesheets/style.css?<?- version ?>' />
    <link rel='stylesheet' type="text/css" href='/dashboard/css/bootstrap-icons.css?<?- version ?>' />
    <link href='//fonts.googleapis.com/css?family=Bitter:400,700,400italic' rel='stylesheet' type='text/css'>
    <? if (css) { ?>
      <link href="/dashboard<?- css ?>" rel="stylesheet" type="text/css" />
    <? } ?>
  </head>
  <body>

    <script type="text/javascript">
      window.Context = <?- JSON.stringify(context) ?>;
    </script>

    <div id="header">
      <h1></h1>
      <div class="seperator">&nbsp;</div>
      <div class="btn-group" id="open-btn-group">
        <a class="btn btn-outline-light" href="#" id="open-btn" target="_blank" data-bs-title="Open app in new tab"><i class="bi bi-eye"></i> Open</a>
        <!-- <button class="btn dropdown-toggle"><span class="caret"></span></button> -->
      </div>
      <!-- <div class="btn-group" id="deploy-btn-group">
        <button class="btn"><i class="bi bi-upload"></i> Deploy</button>
        <button class="btn dropdown-toggle"><i class="bi bi-caret-down-fill"></i></button>
      </div> -->
    </div>
    <div id="body-container">
      <div id="resource-sidebar-container">
        <div class="well hide">
          <div class="section-header">
            <h3>Resources</h3>
            <div class="btn-group">
              <a class="btn btn-success dropdown-toggle" data-bs-toggle="dropdown" href="#" data-bs-title="Create resource">
                <i class="bi bi-plus-lg"></i>
              </a>
              <ul id="resource-types" class="dropdown-menu">
              </ul>
            </div>
          </div>
          <div class="mb-2" aria-label="Filter resources">
            <div class="input-group input-group-sm">
              <span class="input-group-text"><i class="bi bi-search"></i></span>
              <input id="resource-search" type="text" class="form-control" placeholder="Filter resources..." autocomplete="off" />
            </div>
            <div class="d-flex justify-content-end mt-1">
              <button type="button" class="btn btn-sm btn-secondary" data-bs-toggle="modal" data-bs-target="#shortcut-help" aria-label="Show keyboard shortcuts">
                <i class="bi bi-question-circle"></i>
              </button>
            </div>
          </div>
          <div id="resources-empty" class="alert alert-info hide">Add a resource to get started</div>
          <ul class="nav nav-stacked type-icons" id="resource-sidebar">
          </ul>
        </div>
      </div>
      <div id="main-container">
        <? if (render.bodyHtml) { ?>
          <?- render.bodyHtml ?>
        <? } ?>
      </div>
    </div>

    <script type="text/html" id="resource-sidebar-template">
      <% if(type) { %>
        <li class="group-type"><%- type.label || type.type %></span>
      <% } else { %>
        <% var type = types[resource.type]; %>
        <% var isCurrent = resource.id === Context.resourceId %>

        <li class="resource" <%= isCurrent ? 'class="active"' : '' %>>
          <a href="/dashboard/<%= resource.id %>" <%= type && type.dashboardPages ? 'class="pages-header"' : '' %>>
            <% var rt = (resource.type || '').toLowerCase(); var icon = 'folder';
               if (rt === 'collection') icon = 'collection';
               else if (rt === 'users-collection' || rt === 'usercollection' || rt === 'users') icon = 'people';
               else if (rt === 'files' || rt === 'static') icon = 'folder';
               else if (rt === 'string') icon = 'type';
               else if (rt === 'number') icon = '123';
               else if (rt === 'date') icon = 'calendar';
               else if (rt === 'boolean') icon = 'check';
               else if (rt === 'object' || rt === 'properties') icon = 'braces';
               else if (rt === 'data') icon = 'list-ul'; %>
            <i class="bi bi-<%= icon %>"></i>&nbsp;
            <% resource.id.split('/').forEach(function(part, index) { %>
              <span><%- part %></span>
              <% if(index !== resource.id.split('/').length - 1) { %>
                <span class="res-separator"> / </span>
              <% } %>
            <% }); %>
          </a>
          <a href="#" class="options" data-bs-title="Resource actions"><i class="bi bi-caret-down-fill"></i></a>
          <% if (type && type.dashboardPages) { %>
            <ul class="nav pages type-icons <%= isCurrent ? '' : 'hide' %>">
              <% type.dashboardPages.forEach(function(p) { %>
                <% var pl = p.toLowerCase(); var pi = 'file-earmark-text';
                   if (pl === 'events') pi = 'lightning';
                   else if (pl === 'data') pi = 'list-ul';
                   else if (pl === 'properties' || pl === 'config') pi = 'gear'; %>
                <li <%- isCurrent && (Context.page || '').toLowerCase() === p.toLowerCase() ? 'class=active' : ''%>  ><a href="/dashboard/<%= resource.id %>/<%= p.toLowerCase() %>/"><i class="bi bi-<%= pi %>"></i> <%= p %></a></li>
              <% }); %>
            </ul>
          <% } %>
        <% } %>
      </li>
    </script>

    <script type="text/html" id="resource-types-template">
      <% types.forEach(function(type) { %>
         <li>
          <% var tt = (type.label || type.type).toLowerCase(); var ti = 'folder';
             if (tt.indexOf('user') !== -1) ti = 'people';
             else if (tt.indexOf('collection') !== -1) ti = 'collection';
             else if (tt.indexOf('file') !== -1 || tt.indexOf('static') !== -1) ti = 'folder';
             else if (tt.indexOf('event') !== -1) ti = 'lightning';
             else if (tt.indexOf('data') !== -1) ti = 'list-ul'; %>
          <a href="#" data-id="<%= type.id %>">
            <i class="bi bi-<%= ti %>"></i>
            <%- type.label || type.type %>
          </a>
         </li>
      <% }); %>
    </script>

    <script type="text/html" id="event-editor-template">
      <ul class="nav nav-tabs" id="event-nav">
        <% events.forEach(function(e, i) { %>
          <li <%= i === 0 ? 'class="active"' : '' %>><a href="#<%- e.toLowerCase() %>-panel" data-bs-toggle='tab' data-editor="<%- e %>">On <%- e %></a></li>
        <% }) %>
      </ul>
      <div class="tab-content tab-content-styled">
        <% events.forEach(function(e, i) { %>
          <div class="tab-pane <%- i === 0 ? 'active' : '' %>" id="<%- e.toLowerCase() %>-panel" >
            <div class="editor-container">
              <div id="on<%- e %>"></div>
            </div>
          </div>
        <% }) %>
      </div>
    </script>

    <!-- Load vendored modern libs locally -->
    <script type="text/javascript" src="/dashboard/js/lib/jquery-3.7.1.min.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/jquery.cookie-1.4.1.min.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/underscore-1.13.6.min.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/bootstrap-5.3.3.bundle.min.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/ui.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/ace/ace.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/ace/theme-deployd.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/ace/mode-javascript.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/ace/mode-json.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/prettify.js"></script>
    <script type="text/javascript" src="/dpd.js"></script>
    <script type="text/javascript" src="/dashboard/js/events.js?<?- version ?>"></script>
    <script type="text/javascript" src="/dashboard/js/sidebar.js?<?- version ?>"></script>
    <script type="text/javascript" src="/dashboard/js/header.js?<?- version ?>"></script>

    <? if (typeof scripts !== 'undefined') scripts.forEach(function(s) { ?>

      <script type="text/javascript" src="/dashboard<?- s ?>"></script>

    <? }); ?>

    <!-- Keyboard Shortcuts Modal -->
    <div class="modal fade" id="shortcut-help" tabindex="-1" aria-labelledby="shortcutHelpLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="shortcutHelpLabel"><i class="bi bi-keyboard me-2"></i>Keyboard Shortcuts</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <ul>
              <li><strong>/</strong>: Focus resource filter</li>
              <li><strong>j</strong>/<strong>k</strong>: Navigate visible resources</li>
              <li><strong>Enter</strong>: Open highlighted resource</li>
              <li><strong>?</strong>: Show this help</li>
              <li><strong>Esc</strong>: Close dialogs</li>
            </ul>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>


  </body>
</html>
