<!DOCTYPE html>
<html>
  <head>
    <title>Deployd Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- <link rel='stylesheet/less' type="text/css" href='/dashboard/stylesheets/style.less' /> -->
    <!-- <script type="text/javascript" src="/dashboard/js/lib/less-1.3.0.min.js"></script> -->
    <link rel="stylesheet" type="text/css" href="/dashboard/css/bootstrap-5.3.3.min.css" />
    <link rel="stylesheet" type="text/css" href="/dashboard/css/bootstrap-icons.css" />
    <link rel='stylesheet' type="text/css" href='/dashboard/stylesheets/style.css?<?- version ?>' />
    <link href='//fonts.googleapis.com/css?family=Bitter:400,700,400italic' rel='stylesheet' type='text/css'>
    <? if (css) { ?>
      <link href="/dashboard<?- css ?>" rel="stylesheet" type="text/css" />
    <? } ?>
  </head>
  <body>

    <script type="text/javascript">
      window.Context = <?- JSON.stringify(context) ?>;
    </script>

    <div id="header">
      <h1></h1>
      <div class="seperator">&nbsp;</div>
      <div class="btn-group" id="open-btn-group">
        <a class="btn btn-outline-light btn-sm d-inline-flex align-items-center gap-1" href="#" id="open-btn" target="_blank">
          <i class="bi bi-eye"></i>
          <span>Open</span>
        </a>
      </div>
    </div>
    <div id="body-container">
      <div id="resource-sidebar-container"> 
        <div class="dpd-panel d-none" id="resource-sidebar-panel">
          <div class="section-header align-items-center">
            <h3>Resources</h3>
            <div class="btn-group">
              <button class="btn btn-success btn-sm dropdown-toggle d-inline-flex align-items-center gap-1"
                      type="button"
                      id="add-resource-button"
                      data-bs-toggle="dropdown"
                      aria-expanded="false">
                <i class="bi bi-plus-lg"></i>
              </button>
              <ul id="resource-types" class="dropdown-menu dropdown-menu-dark dropdown-menu-end" aria-labelledby="add-resource-button"></ul>
            </div>
          </div>
          <div id="resources-empty" class="alert alert-info d-none">Add a resource to get started</div>
          <ul class="nav nav-pills flex-column type-icons" id="resource-sidebar"></ul>
        </div>
      </div>
      <div id="main-container">
        <? if (render.bodyHtml) { ?>
          <?- render.bodyHtml ?>
        <? } ?>
      </div>
    </div>

    <script type="text/html" id="resource-sidebar-template">
      <% if(type) { %>
        <li class="group-type text-uppercase text-muted small fw-semibold"><%- type.label || type.type %></li>
      <% } else { %>
        <% var typeDef = types[resource.type]; %>
        <% var isCurrent = resource.id === Context.resourceId; %>
        <li class="resource <%= isCurrent ? 'active' : '' %>">
          <div class="resource-entry d-flex align-items-center justify-content-between gap-2">
            <a href="/dashboard/<%= resource.id %>" class="resource-link d-flex align-items-center flex-wrap gap-2 <%= typeDef && typeDef.dashboardPages ? 'pages-header' : '' %>">
              <i class="icon-custom" data-icon="<%- resource.type.toLowerCase() %>"></i>
              <span class="resource-path d-flex align-items-center flex-wrap gap-1">
                <% resource.id.split('/').forEach(function(part, index) { %>
                  <span><%- part %></span>
                  <% if(index !== resource.id.split('/').length - 1) { %>
                    <span class="res-separator text-muted">/</span>
                  <% } %>
                <% }); %>
              </span>
            </a>
            <button type="button" class="btn btn-sm btn-outline-light options" aria-label="Resource options">
              <i class="bi bi-three-dots-vertical"></i>
            </button>
          </div>
          <% if (typeDef && typeDef.dashboardPages) { %>
            <ul class="nav nav-pills flex-column pages type-icons <%= isCurrent ? '' : 'd-none' %>">
              <% typeDef.dashboardPages.forEach(function(p) { 
                   var lower = p.toLowerCase();
                   var pageActive = isCurrent && (Context.page || '').toLowerCase() === lower;
              %>
                <li class="nav-item">
                  <a class="nav-link d-flex align-items-center gap-2 <%= pageActive ? 'active' : '' %>" href="/dashboard/<%= resource.id %>/<%= lower %>/">
                    <i class="icon-custom" data-icon="<%= lower %>"></i>
                    <span><%= p %></span>
                  </a>
                </li>
              <% }); %>
            </ul>
          <% } %>
        </li>
      <% } %>
    </script>

    <script type="text/html" id="resource-types-template">
      <% types.forEach(function(type) { 
           var iconKey = (type.id || type.type || '').toLowerCase();
      %>
         <li>
          <a href="#" data-id="<%= type.id %>" class="dropdown-item d-flex align-items-center gap-2">
            <i class="icon-custom" data-icon="<%- iconKey %>"></i>
            <span><%- type.label || type.type %></span>
          </a>
         </li>
      <% }); %>
    </script>

    <script type="text/html" id="event-editor-template">
      <ul class="nav nav-tabs" id="event-nav">
        <% events.forEach(function(e, i) { %>
          <li class="nav-item"><a class="nav-link <%= i === 0 ? 'active' : '' %>" href="#<%- e.toLowerCase() %>-panel" data-bs-toggle='tab' data-editor="<%- e %>">On <%- e %></a></li>
        <% }) %>
      </ul>
      <div class="tab-content tab-content-styled">
        <% events.forEach(function(e, i) { %>
          <div class="tab-pane fade <%- i === 0 ? 'show active' : '' %>" id="<%- e.toLowerCase() %>-panel" >
            <div class="editor-container">
              <div id="on<%- e %>"></div>
            </div>
          </div>
        <% }) %>
      </div>
    </script>

    <script type="text/javascript" src="/dashboard/js/lib/jquery-3.7.1.min.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/jquery.cookie-1.4.1.min.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/underscore-1.13.6.min.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/bootstrap-5.3.3.bundle.min.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/bootstrap5-jquery-shim.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/ui.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/ace/ace.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/ace/theme-deployd.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/ace/mode-javascript.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/ace/mode-json.js"></script>
    <script type="text/javascript" src="/dashboard/js/lib/prettify.js"></script>
    <script type="text/javascript" src="/dpd.js"></script>
    <script type="text/javascript" src="/dashboard/js/events.js?<?- version ?>"></script>
    <script type="text/javascript" src="/dashboard/js/sidebar.js?<?- version ?>"></script>
    <script type="text/javascript" src="/dashboard/js/header.js?<?- version ?>"></script>

    <? if (typeof scripts !== 'undefined') scripts.forEach(function(s) { ?>

      <script type="text/javascript" src="/dashboard<?- s ?>"></script>

    <? }); ?>


  </body>
</html>



